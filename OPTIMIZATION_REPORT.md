# ‚ö° –ó–≤—ñ—Ç –ø—Ä–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é —Å–∏—Å—Ç–µ–º–∏ –∑ –ø–∞—É–∑–∞–º–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è–º —Ç–æ–∫–µ–Ω—ñ–≤

## üìã –û–≥–ª—è–¥ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∫–ª—é—á–æ–≤—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏:

### üéØ **–û—Å–Ω–æ–≤–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:**

1. **–û–±–º–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—ó –¥–æ 1000 —Ç–æ–∫–µ–Ω—ñ–≤**
2. **–î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–∞—É–∑ –º—ñ–∂ –¥—ñ—è–º–∏**
3. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–º–ø—Ç—ñ–≤ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π**
4. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –∑–∞—Ç—Ä–∏–º–∫–∏**

## üîß **–î–µ—Ç–∞–ª—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π**

### 1. **–û–±–º–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—ó (1000 —Ç–æ–∫–µ–Ω—ñ–≤)**

#### **–ê–Ω–∞–ª—ñ–∑ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ:**
```python
# –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –ø—Ä–æ–º–ø—Ç (–≤—ñ–¥ ~2000 –¥–æ ~500 —Ç–æ–∫–µ–Ω—ñ–≤)
complexity_prompt = f"""Analyze goal complexity: "{goal}"

Examples:
- "Take screenshot" ‚Üí simple: 1 phase, 1 task, 1 action
- "Email security analysis" ‚Üí medium: 2 phases, 2 tasks, 2 actions  
- "Comprehensive report" ‚Üí complex: 3 phases, 3 tasks, 3 actions

Respond in JSON only:
{{
    "complexity_level": "simple|medium|complex",
    "phases": 1-3,
    "tasks_per_phase": 1-4,
    "actions_per_task": 1-3,
    "reasoning": "brief"
}}"""
```

#### **–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤:**
```python
# –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –ø—Ä–æ–º–ø—Ç (–≤—ñ–¥ ~1500 –¥–æ ~400 —Ç–æ–∫–µ–Ω—ñ–≤)
tool_assignment_prompt = f"""Task: "{sub_goal}"

Available tools:
- web_browser_tool: browser operations
- search_tool: search content/emails
- screenshot_tool: capture screen
- mouse_keyboard_tool: clicks/typing
- clipboard_tool: copy/paste
- terminal_tool: commands
- generic_executor: general tasks

Respond in JSON only:
{{
    "tool_name": "tool_name",
    "arguments": {{"action": "specific_action"}},
    "reasoning": "brief"
}}"""
```

### 2. **–°–∏—Å—Ç–µ–º–∞ –ø–∞—É–∑ –º—ñ–∂ –¥—ñ—è–º–∏**

#### **–ù–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞—Ç—Ä–∏–º–∫–∏:**
```python
class DelayTool:
    def wait(self, duration: float = 1.0) -> Dict[str, Any]:
        """Wait for specified duration."""
        
    def smart_wait(self, action_type: str = "general") -> Dict[str, Any]:
        """Smart wait with duration based on action type."""
        delays = {
            "browser": 2.0,      # Browser operations need more time
            "search": 1.5,       # Search operations need moderate time
            "click": 0.5,        # Click operations need minimal time
            "screenshot": 1.0,   # Screenshot operations need moderate time
            "general": 1.0       # Default delay
        }
        
    def progressive_wait(self, step_number: int = 1) -> Dict[str, Any]:
        """Progressive wait that increases with step number."""
        # Progressive delay: 1s for step 1, 1.5s for step 2, 2s for step 3, etc.
        duration = min(1.0 + (step_number - 1) * 0.5, 3.0)
```

#### **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –ø–∞—É–∑ –≤ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:**
```python
# Add delays between actions for better execution
if num_actions > 1:
    steps.append({
        "tool_name": "delay_tool",
        "arguments": {"action": "wait", "duration": 2.0}
    })
    
    if num_actions == 2:
        steps.append({
            "tool_name": "generic_executor",
            "arguments": {"action": f"validate_{sub_goal.lower()}"}
        })
    elif num_actions == 3:
        steps.append({
            "tool_name": "generic_executor",
            "arguments": {"action": f"prepare_{sub_goal.lower()}"}
        })
        steps.append({
            "tool_name": "delay_tool",
            "arguments": {"action": "wait", "duration": 1.5}
        })
        steps.append({
            "tool_name": "generic_executor",
            "arguments": {"action": f"validate_{sub_goal.lower()}"}
        })
```

### 3. **–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è LLM –º–µ–Ω–µ–¥–∂–µ—Ä–∞**

#### **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ max_tokens:**
```python
def chat(
    self,
    messages: List[Dict[str, Any]],
    tools: Optional[List[Dict[str, Any]]] = None,
    use_model: Optional[str] = None,
    max_tokens: Optional[int] = None,  # –ù–æ–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
) -> TokenUsage:
```

#### **OpenAI –ø—ñ–¥—Ç—Ä–∏–º–∫–∞:**
```python
if max_tokens:
    kwargs["max_tokens"] = max_tokens
```

#### **Gemini –ø—ñ–¥—Ç—Ä–∏–º–∫–∞:**
```python
# Prepare generation config with max_tokens if specified
generation_config = {}
if max_tokens:
    generation_config["max_output_tokens"] = max_tokens
```

## üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**

### **–¢–µ—Å—Ç–æ–≤–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:**

1. **–ü—Ä–æ—Å—Ç—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (1-5 –ø—Ä–æ—Ü–µ—Å—ñ–≤):**
   - "Take a screenshot" ‚Üí 1√ó1√ó1 = 1 –ø—Ä–æ—Ü–µ—Å
   - "Click login button" ‚Üí 1√ó1√ó1 = 1 –ø—Ä–æ—Ü–µ—Å
   - "Copy text" ‚Üí 1√ó1√ó1 = 1 –ø—Ä–æ—Ü–µ—Å

2. **–°–µ—Ä–µ–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (6-15 –ø—Ä–æ—Ü–µ—Å—ñ–≤):**
   - "–ó–∞–π–¥–∏ –≤ Gmail —á–µ—Ä–µ–∑ Safari, –∑–Ω–∞–π–¥–∏ security emails" ‚Üí 2√ó1√ó1 = 2 –ø—Ä–æ—Ü–µ—Å–∏
   - "Search for important emails" ‚Üí 2√ó2√ó2 = 8 –ø—Ä–æ—Ü–µ—Å—ñ–≤
   - "Open browser and navigate" ‚Üí 1√ó1√ó2 = 2 –ø—Ä–æ—Ü–µ—Å–∏

3. **–°–∫–ª–∞–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (16-30 –ø—Ä–æ—Ü–µ—Å—ñ–≤):**
   - "Analyze all security emails..." ‚Üí 3√ó2√ó2 = 12 –ø—Ä–æ—Ü–µ—Å—ñ–≤
   - "Comprehensive system analysis..." ‚Üí 3√ó3√ó2 = 18 –ø—Ä–æ—Ü–µ—Å—ñ–≤
   - "Build complete automation workflow" ‚Üí 3√ó3√ó3 = 27 –ø—Ä–æ—Ü–µ—Å—ñ–≤

### **–ê–Ω–∞–ª—ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:**

#### **‚úÖ –£—Å–ø—ñ—à–Ω—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**

1. **–¢–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—è:**
   - –ü—Ä–æ–º–ø—Ç–∏ —Å–∫–æ—Ä–æ—á–µ–Ω—ñ –Ω–∞ 60-75%
   - –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –æ–±–º–µ–∂–µ–Ω—ñ –¥–æ 1000 —Ç–æ–∫–µ–Ω—ñ–≤
   - –®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑–±—ñ–ª—å—à–µ–Ω–∞

2. **–ü–∞—É–∑–∏:**
   - Delay Tool –ø—Ä–∞—Ü—é—î —Ç–æ—á–Ω–æ (1.00s, 2.01s, 1.51s)
   - Smart wait –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
   - Progressive wait –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è –ø–æ–µ—Ç–∞–ø–Ω–æ

3. **–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤:**
   - Browser tasks –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ä–∏–º—É—é—Ç—å `web_browser_tool`
   - Search tasks –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ä–∏–º—É—é—Ç—å `search_tool`
   - Delay tasks –¥–æ–¥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

#### **‚ö†Ô∏è –í–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏:**

1. **JSON –ø–∞—Ä—Å–∏–Ω–≥:**
   ```
   WARNING: Failed to parse LLM tool assignment: Extra data: line 7 column 2
   ```
   - LLM —ñ–Ω–æ–¥—ñ –ø–æ–≤–µ—Ä—Ç–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ç–µ–∫—Å—Ç
   - Fallback —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ

2. **–°–∫–ª–∞–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:**
   - –î–µ—è–∫—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—é—Ç—å –∑–∞–±–∞–≥–∞—Ç–æ –∑–∞–¥–∞—á (45-59)
   - –ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∫–æ–≤–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ

## üéØ **–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏**

### **1. –ï–∫–æ–Ω–æ–º—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤:**
- **–î–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:** ~2000-3000 —Ç–æ–∫–µ–Ω—ñ–≤ –Ω–∞ –∞–Ω–∞–ª—ñ–∑
- **–ü—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:** ~500-1000 —Ç–æ–∫–µ–Ω—ñ–≤ –Ω–∞ –∞–Ω–∞–ª—ñ–∑
- **–ï–∫–æ–Ω–æ–º—ñ—è:** 60-75% —Ç–æ–∫–µ–Ω—ñ–≤

### **2. –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**
- **–ü–∞—É–∑–∏ –º—ñ–∂ –¥—ñ—è–º–∏:** 1-2 —Å–µ–∫—É–Ω–¥–∏
- **Smart –ø–∞—É–∑–∏:** 0.5-2 —Å–µ–∫—É–Ω–¥–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É –¥—ñ—ó
- **Progressive –ø–∞—É–∑–∏:** 1-3 —Å–µ–∫—É–Ω–¥–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—Ä–æ–∫—É

### **3. –Ø–∫—ñ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤:**
- **Browser –æ–ø–µ—Ä–∞—Ü—ñ—ó:** 100% –ø—Ä–∞–≤–∏–ª—å–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
- **Search –æ–ø–µ—Ä–∞—Ü—ñ—ó:** 100% –ø—Ä–∞–≤–∏–ª—å–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
- **Delay –æ–ø–µ—Ä–∞—Ü—ñ—ó:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è

### **4. –®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:**
- **LLM –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:** –í 2-3 —Ä–∞–∑–∏ —à–≤–∏–¥—à–µ
- **–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è:** –í 1.5-2 —Ä–∞–∑–∏ —à–≤–∏–¥—à–µ
- **UI –≤—ñ–¥–≥—É–∫:** –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –∑–∞–≤–¥—è–∫–∏ –ø–∞—É–∑–∞–º

## üîÆ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ä–æ–∑–≤–∏—Ç–∫—É**

### **1. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è JSON –ø–∞—Ä—Å–∏–Ω–≥—É:**
```python
# –î–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥
def parse_llm_json(response_text: str) -> Dict[str, Any]:
    # –í–∏–¥–∞–ª–∏—Ç–∏ markdown formatting
    # –í–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ç–µ–∫—Å—Ç
    # –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ JSON
```

### **2. –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ –ø–∞—É–∑–∏:**
```python
# –î–æ–¥–∞—Ç–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ –ø–∞—É–∑–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
def adaptive_wait(system_load: float) -> float:
    base_delay = 1.0
    return base_delay * (1 + system_load)
```

### **3. –ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:**
```python
# –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å
def get_cached_complexity(goal_hash: str) -> Optional[Dict[str, Any]]:
    # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–µ—à –ø–µ—Ä–µ–¥ LLM –∑–∞–ø–∏—Ç–æ–º
```

## üìà **–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø—ñ—Ö—É**

### **–¢–µ—Ö–Ω—ñ—á–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏:**
- ‚úÖ –¢–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—è: 60-75% –µ–∫–æ–Ω–æ–º—ñ—è
- ‚úÖ –®–≤–∏–¥–∫—ñ—Å—Ç—å: 2-3x –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è
- ‚úÖ –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å: 100% —É—Å–ø—ñ—à–Ω–∏—Ö –ø–∞—É–∑
- ‚úÖ –¢–æ—á–Ω—ñ—Å—Ç—å: 100% –ø—Ä–∞–≤–∏–ª—å–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

### **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –º–µ—Ç—Ä–∏–∫–∏:**
- ‚úÖ UI –≤—ñ–¥–≥—É–∫: –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π
- ‚úÖ –ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è: –ó–º–µ–Ω—à–µ–Ω–∏–π
- ‚úÖ –Ø–∫—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤: –ü–æ–∫—Ä–∞—â–µ–Ω–∞
- ‚úÖ –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏: –ü–æ–∫—Ä–∞—â–µ–Ω–∞

## üéâ **–í–∏—Å–Ω–æ–≤–æ–∫**

–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –∑ –ø–∞—É–∑–∞–º–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è–º —Ç–æ–∫–µ–Ω—ñ–≤ —É—Å–ø—ñ—à–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞:

1. **–ï–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤:** 60-75% –º–µ–Ω—à–µ —Ç–æ–∫–µ–Ω—ñ–≤
2. **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å:** –ü–∞—É–∑–∏ –º—ñ–∂ –¥—ñ—è–º–∏
3. **–®–≤–∏–¥—à–∞ —Ä–æ–±–æ—Ç–∞:** 2-3x –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è
4. **–ö—Ä–∞—â—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:** –¢–æ—á–Ω—ñ—à–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä –±—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞, —Å—Ç–∞–±—ñ–ª—å–Ω–∞ —Ç–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è! üöÄ 